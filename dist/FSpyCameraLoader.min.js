!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("three")):"function"==typeof define&&define.amd?define(["three"],a):(t=t||self).FSpyCameraLoader=a(t.THREE)}(this,(function(t){"use strict";var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var e in a)a.hasOwnProperty(e)&&(t[e]=a[e])})(t,e)};var e=1,i=50,n=1,r=function(){function a(){this.rawData=null,this.data=null,this.internalImageRatio=e,this.internalCameraFov=i,this.internalOriginalImageSize=new t.Vector2,this.internalCameraTransformMatrix=new t.Matrix4,this.internalViewTransformMatrix=new t.Matrix4,this.internalCameraPosition=new t.Vector3,this.internalIsSetData=!1}return a.prototype.setData=function(t){this.internalIsSetData=!0,this.rawData=t,this.onSetData()},a.prototype.removeData=function(){this.internalIsSetData=!1,this.rawData=null,this.onRemoveData()},a.prototype.getData=function(){return this.rawData},a.prototype.getComputedData=function(){return this.data},a.prototype.setComputedData=function(){null!=this.rawData&&(this.data={},this.data.principalPoint=new t.Vector2(this.rawData.principalPoint.x,this.rawData.principalPoint.y),this.data.viewTransform=this.internalViewTransformMatrix,this.data.cameraTransform=this.internalCameraTransformMatrix,this.data.horizontalFieldOfView=this.rawData.horizontalFieldOfView,this.data.verticalFieldOfView=this.rawData.verticalFieldOfView,this.data.vanishingPoints=[new t.Vector2(this.rawData.vanishingPoints[0].x,this.rawData.vanishingPoints[0].y),new t.Vector2(this.rawData.vanishingPoints[1].x,this.rawData.vanishingPoints[1].y),new t.Vector2(this.rawData.vanishingPoints[2].x,this.rawData.vanishingPoints[2].y)],this.data.vanishingPointAxes=[this.rawData.vanishingPointAxes[0],this.rawData.vanishingPointAxes[1],this.rawData.vanishingPointAxes[2]],this.data.relativeFocalLength=this.rawData.relativeFocalLength,this.data.imageWidth=this.rawData.imageWidth,this.data.imageHeight=this.rawData.imageHeight,this.data.imageSize=this.internalOriginalImageSize,this.data.imageRatio=this.internalImageRatio,this.data.cameraPosition=this.internalCameraPosition,this.data.cameraFov=this.internalCameraFov)},a.prototype.onSetData=function(){this.internalImageRatio=this.calcImageRatio(),null!=this.rawData&&(this.internalOriginalImageSize=new t.Vector2(this.rawData.imageWidth,this.rawData.imageHeight),this.internalCameraFov=a.getVFovDegFromRad(this.rawData.verticalFieldOfView),this.setTransformMatrix(this.rawData.cameraTransform.rows,this.internalCameraTransformMatrix),this.setTransformMatrix(this.rawData.viewTransform.rows,this.internalViewTransformMatrix),this.setCameraPosition(this.internalCameraTransformMatrix),this.setComputedData())},a.prototype.onRemoveData=function(){this.internalImageRatio=e,this.internalCameraFov=i,this.internalOriginalImageSize=new t.Vector2,this.internalCameraTransformMatrix=new t.Matrix4,this.internalViewTransformMatrix=new t.Matrix4,this.internalCameraPosition=new t.Vector3,this.data=null},a.prototype.calcImageRatio=function(){return null!=this.rawData?this.rawData.imageWidth/this.rawData.imageHeight:e},a.getVFovDegFromRad=function(a){return t.MathUtils.radToDeg(a)},a.prototype.setTransformMatrix=function(a,e){if(null!=this.rawData){var i=e,n=a.reduce((function(t,a){return t.push.apply(t,a),t}),[]);return i.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]),i}return new t.Matrix4},a.prototype.setCameraPosition=function(a){if(null!=this.rawData){var e=a.elements;this.internalCameraPosition=new t.Vector3(e[12],e[13],e[14])}return this.internalCameraPosition},Object.defineProperty(a.prototype,"imageRatio",{get:function(){return this.internalImageRatio},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"cameraMatrix",{get:function(){return this.internalCameraTransformMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"viewMatrix",{get:function(){return this.internalViewTransformMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"cameraFov",{get:function(){return this.internalCameraFov},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"cameraPosition",{get:function(){return this.internalCameraPosition},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isSetData",{get:function(){return this.internalIsSetData},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"imageSize",{get:function(){return this.internalOriginalImageSize},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"imageWidth",{get:function(){return this.internalOriginalImageSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"imageHeight",{get:function(){return this.internalOriginalImageSize.height},enumerable:!1,configurable:!0}),a}(),s=function(){function t(){this.xhr=new XMLHttpRequest}return t.prototype.load=function(t,a){this.xhr.open("GET",t),this.xhr.responseType="json",this.xhr.addEventListener("load",(function(){var t=JSON.parse(this.response);a(t)})),this.xhr.send()},t}();return function(e){function i(a){var n=e.call(this)||this;return t.Loader.call(n,a),n.isIE=i.getIsUseIE(),n.targetCanvas=null,n.targetCanvasSize=new t.Vector2,n.camera=new t.PerspectiveCamera,n.dataManager=new r,n.internalIsEnableResizeEvent=!1,n}return function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(i,e),Object.defineProperty(i.prototype,"isEnableResizeEvent",{get:function(){return this.internalIsEnableResizeEvent},set:function(t){this.internalIsEnableResizeEvent!==t&&(this.internalIsEnableResizeEvent=t,this.internalIsEnableResizeEvent?window.addEventListener("resize",this.onResize.bind(this)):window.removeEventListener("resize",this.onResize.bind(this)))},enumerable:!1,configurable:!0}),i.prototype.load=function(a,e,i,n){var r,o=this;this.isIE?(r=new s).load(a,(function(t){null!=e&&e(o.parse(t))})):((r=new t.FileLoader(this.manager)).setPath(this.path),r.setResponseType("json"),r.load(a,(function(t){null!=e&&e(o.parse(t))}),i,n))},i.prototype.parse=function(t){return this.dataManager.setData(t),this.createCamera()},i.prototype.setCanvas=function(t){this.targetCanvas=t},i.prototype.removeCanvas=function(){this.targetCanvas=null},i.prototype.setResizeUpdate=function(){this.isEnableResizeEvent=!0},i.prototype.removeResizeupdate=function(){this.isEnableResizeEvent=!1},i.prototype.createCamera=function(){return this.dataManager.isSetData&&(this.camera.fov=this.dataManager.cameraFov,null!=this.targetCanvasSize?this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y:this.camera.aspect=this.dataManager.imageRatio,this.camera.position.set(this.dataManager.cameraPosition.x,this.dataManager.cameraPosition.y,this.dataManager.cameraPosition.z),this.camera.setRotationFromMatrix(this.dataManager.rotationMatrix),this.onResize()),this.camera},i.getIsUseIE=function(){return window.navigator.userAgent.toLowerCase().indexOf("trident")>=0},i.prototype.onResize=function(){if(null!=this.targetCanvas){var t=this.targetCanvas.getBoundingClientRect(),a=this.dataManager.imageRatio;this.targetCanvasSize.setX(t.width),this.targetCanvasSize.setY(t.height),this.targetCanvasSize.x/this.targetCanvasSize.y<=a?(this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y,this.camera.zoom=n):(this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y,this.camera.zoom=this.targetCanvasSize.x/this.targetCanvasSize.y/a),this.camera.updateProjectionMatrix()}},i.prototype.getData=function(){return this.dataManager.getData()},i.prototype.getComputedData=function(){return this.dataManager.getComputedData()},i}(t.Loader)}));
