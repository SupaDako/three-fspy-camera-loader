!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("three")):"function"==typeof define&&define.amd?define(["three"],i):(t=t||self).FSpyCamera=i(t.THREE)}(this,(function(t){"use strict";var i=function(){function t(){this.xhr=new XMLHttpRequest,this.xhr.responseType="json"}return t.prototype.open=function(t,i){this.xhr.open("GET",t),this.xhr.addEventListener("load",(function(){var t=this.response;i(t)})),this.xhr.send()},t}();function a(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}return function(){function e(i,e){void 0===e&&(e={}),this.inputData="",this.fspyImageRatio=0,this.fSpyCameraData=null,this.rotationMatrix=new t.Matrix4,this.targetCanvas=i,this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.winRatio=this.winWidth/this.winHeight,this.camera=new t.PerspectiveCamera,this.canvasWidth=0,this.canvasHeight=0,this.cameraTransforms=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.options=e,this.callback=function(){},this.jsonType=a(this.inputData),this.initCameraAspect=0,this.cameraFov=0,this.canvasWidth=window.innerWidth,this.canvasHeight=500}return e.prototype.load=function(t,i){if(this.inputData=t,this.callback=i,"string"===this.jsonType&&"string"==typeof this.inputData){var a=(s=this.inputData,-1===(n=s.lastIndexOf("."))?"":s.slice(n+1));"json"===a.toLowerCase()?this.loadJson(this.inputData):"fspy"===a.toLowerCase()&&e.loadBinary()}else"object"===this.jsonType&&"object"==typeof this.inputData?this.fSpyCameraData=this.inputData:console.error("Please put fSpy's json path or parsed json in the first argument");var s,n},e.prototype.loadJson=function(t){(new i).open(t,this.onLoadJson.bind(this))},e.loadBinary=function(){console.log("temp")},e.prototype.onLoadJson=function(t){this.fSpyCameraData=t,null!=this.fSpyCameraData&&(this.cameraTransforms=this.fSpyCameraData.cameraTransform.rows),this.fspyImageRatio=this.getFSpyImageRatio(),this.setMatrix(),this.createCamera(),window.addEventListener("resize",this.onResize.bind(this)),this.runCallback.bind(this)()},e.onLoadBinary=function(){console.log("temp")},e.prototype.setMatrix=function(){var t=this.cameraTransforms.reduce((function(t,i){return t.push.apply(t,i),t}),[]);return this.rotationMatrix.elements=t,this.rotationMatrix},e.getWinRatio=function(){return window.innerWidth/window.innerHeight},e.prototype.getFSpyImageRatio=function(){return null!=this.fSpyCameraData?this.fSpyCameraData.imageWidth/this.fSpyCameraData.imageHeight:0},e.getVFovDegFromRad=function(i){return t.MathUtils.radToDeg(i)},e.prototype.createCamera=function(){if(null!=this.cameraTransforms&&null!=this.fSpyCameraData){var t=this.cameraTransforms;this.cameraFov=e.getVFovDegFromRad(this.fSpyCameraData.verticalFieldOfView),this.camera.fov=this.cameraFov,this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.near=.01,this.camera.far=1e4,this.camera.position.set(t[0][3],t[1][3],t[2][3]),this.camera.setRotationFromMatrix(this.rotationMatrix),this.initCameraAspect=this.camera.aspect}},e.prototype.onResize=function(){this.canvasWidth=window.innerWidth,this.canvasHeight=500,this.canvasWidth/this.canvasHeight<=this.getFSpyImageRatio()?(this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.zoom=1):(this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.zoom=this.canvasWidth/this.canvasHeight/this.getFSpyImageRatio()),this.camera.updateProjectionMatrix()},e.prototype.runCallback=function(){"function"===a(this.callback)&&this.callback(this)},e}()}));
