import{MathUtils as t,Matrix4 as a,PerspectiveCamera as i}from"three";var e=function(){function t(){this.xhr=new XMLHttpRequest}return t.prototype.open=function(t,a){this.xhr.open("GET",t),this.xhr.responseType="json",this.xhr.addEventListener("load",(function(){var t,i="ie"===(-1!==(t=window.navigator.userAgent.toLowerCase()).indexOf("msie")||-1!==t.indexOf("trident")?"ie":-1!==t.indexOf("edge")?"edge":-1!==t.indexOf("chrome")?"chrome":-1!==t.indexOf("safari")?"safari":-1!==t.indexOf("firefox")?"firefox":-1!==t.indexOf("opera")?"opera":"other")?JSON.parse(this.response):this.response;a(i)})),this.xhr.send()},t}();function s(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}var n=function(){function n(t,e){void 0===e&&(e={}),this.inputData="",this.fspyImageRatio=0,this.fSpyCameraData=null,this.rotationMatrix=new a,this.targetCanvas=t,this.targetCanvasRect=this.targetCanvas.getBoundingClientRect(),this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.winRatio=this.winWidth/this.winHeight,this.camera=new i,this.canvasWidth=this.targetCanvasRect.width,this.canvasHeight=this.targetCanvasRect.height,this.cameraTransforms=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.options=e,this.callback=function(){},this.jsonType=s(this.inputData),this.initCameraAspect=0,this.cameraFov=0}return n.prototype.load=function(t,a){if(this.inputData=t,this.callback=a,"string"===this.jsonType&&"string"==typeof this.inputData){var i=(e=this.inputData,-1===(s=e.lastIndexOf("."))?"":e.slice(s+1));"json"===i.toLowerCase()?this.loadJson(this.inputData):"fspy"===i.toLowerCase()&&n.loadBinary()}else"object"==typeof this.inputData?this.onLoadJson(this.inputData):console.error("Please put fSpy's json path or parsed json in the first argument");var e,s},n.prototype.loadJson=function(t){(new e).open(t,this.onLoadJson.bind(this))},n.loadBinary=function(){console.log("temp")},n.prototype.onLoadJson=function(t){this.fSpyCameraData=t,null!=this.fSpyCameraData&&(this.cameraTransforms=this.fSpyCameraData.cameraTransform.rows),this.fspyImageRatio=this.getFSpyImageRatio(),this.setMatrix(),this.createCamera(),window.addEventListener("resize",this.onResize.bind(this)),this.runCallback.bind(this)()},n.onLoadBinary=function(){console.log("temp")},n.prototype.setMatrix=function(){var t=this.cameraTransforms.reduce((function(t,a){return t.push.apply(t,a),t}),[]);return this.rotationMatrix.elements=t,this.rotationMatrix},n.getWinRatio=function(){return window.innerWidth/window.innerHeight},n.prototype.getFSpyImageRatio=function(){return null!=this.fSpyCameraData?this.fSpyCameraData.imageWidth/this.fSpyCameraData.imageHeight:0},n.getVFovDegFromRad=function(a){return t.radToDeg(a)},n.prototype.createCamera=function(){if(null!=this.cameraTransforms&&null!=this.fSpyCameraData){var t=this.cameraTransforms;this.cameraFov=n.getVFovDegFromRad(this.fSpyCameraData.verticalFieldOfView),this.camera.fov=this.cameraFov,this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.near=.01,this.camera.far=1e4,this.camera.position.set(t[0][3],t[1][3],t[2][3]),this.camera.setRotationFromMatrix(this.rotationMatrix),this.initCameraAspect=this.getFSpyImageRatio(),this.onResize()}},n.prototype.onResize=function(){this.targetCanvasRect=this.targetCanvas.getBoundingClientRect(),this.canvasWidth=this.targetCanvasRect.width,this.canvasHeight=this.targetCanvas.height;var t=this.initCameraAspect;this.canvasWidth/this.canvasHeight<=t?(this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.zoom=1):(this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.zoom=this.canvasWidth/this.canvasHeight/t),this.camera.updateProjectionMatrix()},n.prototype.runCallback=function(){"function"===s(this.callback)&&this.callback()},n}();export default n;
