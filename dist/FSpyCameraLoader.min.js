!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("three")):"function"==typeof define&&define.amd?define(["three"],a):(t=t||self).FSpyCamera=a(t.THREE)}(this,(function(t){"use strict";var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var e in a)a.hasOwnProperty(e)&&(t[e]=a[e])})(t,e)};var e=1,i=50,n=1,r=function(){function a(){this.data=null,this.internalImageRatio=e,this.internalCameraFov=i,this.radian=0,this.internalRotationMatrix=new t.Matrix4,this.internalCameraPosition=new t.Vector3,this.internalIsSetData=!1}return a.prototype.setData=function(t){this.internalIsSetData=!0,this.data=t,this.onSetData()},a.prototype.removeData=function(){this.internalIsSetData=!1,this.data=null,this.onRemoveData()},a.prototype.getData=function(){return this.data},a.prototype.onSetData=function(){this.internalImageRatio=this.calcImageRatio(),null!=this.data&&(this.internalCameraFov=this.getVFovDegFromRad(this.data.verticalFieldOfView),this.setMatrix(),this.setCameraPosition())},a.prototype.onRemoveData=function(){this.internalImageRatio=e,this.internalCameraFov=i,this.internalRotationMatrix=new t.Matrix4,this.internalCameraPosition=new t.Vector3},a.prototype.calcImageRatio=function(){return null!=this.data?this.data.imageWidth/this.data.imageHeight:e},a.prototype.getVFovDegFromRad=function(a){return this.radian=t.MathUtils.radToDeg(a),this.radian},a.prototype.setMatrix=function(){if(null!=this.data){var a=this.data.cameraTransform.rows.reduce((function(t,a){return t.push.apply(t,a),t}),[]);return this.internalRotationMatrix.elements=a,this.internalRotationMatrix}return new t.Matrix4},a.prototype.setCameraPosition=function(){if(null!=this.data){var a=this.data.cameraTransform.rows;this.internalCameraPosition=new t.Vector3(a[0][3],a[1][3],a[2][3])}},Object.defineProperty(a.prototype,"imageRatio",{get:function(){return this.internalImageRatio},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationMatrix",{get:function(){return this.internalRotationMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraFov",{get:function(){return this.internalCameraFov},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraPosition",{get:function(){return this.internalCameraPosition},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isSetData",{get:function(){return this.internalIsSetData},enumerable:!0,configurable:!0}),a}();return function(i){function o(a){var e=i.call(this)||this;return t.Loader.call(e,a),e.targetCanvas=null,e.targetCanvasRect=null,e.targetCanvasSize=new t.Vector2,e.camera=new t.PerspectiveCamera,e.dataManager=new r,e}return function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(o,i),o.prototype.load=function(a,e,i,n){var r=this,o=new t.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("json"),o.load(a,(function(t){var a=t;e(r.parse(a))}),i,n)},o.prototype.parse=function(t){return this.dataManager.setData(t),this.createCamera(),this.camera},o.prototype.setCanvas=function(t){this.targetCanvas=t},o.prototype.removeCanvas=function(){this.targetCanvas=null},o.prototype.setResizeUpdate=function(t){t&&this.setCanvas(t),window.addEventListener("resize",this.onResize.bind(this))},o.prototype.removeResizeupdate=function(t){t&&this.removeCanvas(),window.removeEventListener("resize",this.onResize.bind(this))},o.prototype.createCamera=function(){this.dataManager.isSetData&&(this.camera.fov=this.dataManager.cameraFov,null!=this.targetCanvasSize?this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y:this.camera.aspect=e,this.camera.position.set(this.dataManager.cameraPosition.x,this.dataManager.cameraPosition.y,this.dataManager.cameraPosition.z),this.camera.setRotationFromMatrix(this.dataManager.rotationMatrix),this.onResize())},o.prototype.onResize=function(){if(null!=this.targetCanvas){this.targetCanvasRect=this.targetCanvas.getBoundingClientRect();var t=this.dataManager.imageRatio;this.targetCanvasSize.setX(this.targetCanvasRect.width),this.targetCanvasSize.setY(this.targetCanvasRect.height),this.targetCanvasSize.x/this.targetCanvasSize.y<=t?(this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y,this.camera.zoom=n):(this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y,this.camera.zoom=this.targetCanvasSize.x/this.targetCanvasSize.y/t),this.camera.updateProjectionMatrix()}},o}(t.Loader)}));
