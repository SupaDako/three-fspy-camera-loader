import{MathUtils as t,Matrix4 as a,PerspectiveCamera as i}from"three";var s=function(){function t(){this.xhr=new XMLHttpRequest,this.xhr.responseType="json"}return t.prototype.open=function(t,a){this.xhr.open("GET",t),this.xhr.addEventListener("load",(function(){var t=this.response;a(t)})),this.xhr.send()},t}();function e(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}var n=function(){function n(t,s){void 0===s&&(s={}),this.inputData="",this.fspyImageRatio=0,this.fSpyCameraData=null,this.rotationMatrix=new a,this.targetCanvas=t,this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.winRatio=this.winWidth/this.winHeight,this.camera=new i,this.canvasWidth=0,this.canvasHeight=0,this.cameraTransforms=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.options=s,this.callback=function(){},this.jsonType=e(this.inputData),this.initCameraAspect=0,this.cameraFov=0,this.canvasWidth=window.innerWidth,this.canvasHeight=500}return n.prototype.load=function(t,a){if(this.inputData=t,this.callback=a,"string"===this.jsonType&&"string"==typeof this.inputData){var i=(s=this.inputData,-1===(e=s.lastIndexOf("."))?"":s.slice(e+1));"json"===i.toLowerCase()?this.loadJson(this.inputData):"fspy"===i.toLowerCase()&&n.loadBinary()}else"object"===this.jsonType&&"object"==typeof this.inputData?this.fSpyCameraData=this.inputData:console.error("Please put fSpy's json path or parsed json in the first argument");var s,e},n.prototype.loadJson=function(t){(new s).open(t,this.onLoadJson.bind(this))},n.loadBinary=function(){console.log("temp")},n.prototype.onLoadJson=function(t){this.fSpyCameraData=t,null!=this.fSpyCameraData&&(this.cameraTransforms=this.fSpyCameraData.cameraTransform.rows),this.fspyImageRatio=this.getFSpyImageRatio(),this.setMatrix(),this.createCamera(),window.addEventListener("resize",this.onResize.bind(this)),this.runCallback.bind(this)()},n.onLoadBinary=function(){console.log("temp")},n.prototype.setMatrix=function(){var t=this.cameraTransforms.reduce((function(t,a){return t.push.apply(t,a),t}),[]);return this.rotationMatrix.elements=t,this.rotationMatrix},n.getWinRatio=function(){return window.innerWidth/window.innerHeight},n.prototype.getFSpyImageRatio=function(){return null!=this.fSpyCameraData?this.fSpyCameraData.imageWidth/this.fSpyCameraData.imageHeight:0},n.getVFovDegFromRad=function(a){return t.radToDeg(a)},n.prototype.createCamera=function(){if(null!=this.cameraTransforms&&null!=this.fSpyCameraData){var t=this.cameraTransforms;this.cameraFov=n.getVFovDegFromRad(this.fSpyCameraData.verticalFieldOfView),this.camera.fov=this.cameraFov,this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.near=.01,this.camera.far=1e4,this.camera.position.set(t[0][3],t[1][3],t[2][3]),this.camera.setRotationFromMatrix(this.rotationMatrix),this.initCameraAspect=this.camera.aspect}},n.prototype.onResize=function(){this.canvasWidth=window.innerWidth,this.canvasHeight=500,this.canvasWidth/this.canvasHeight<=this.getFSpyImageRatio()?(this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.zoom=1):(this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.zoom=this.canvasWidth/this.canvasHeight/this.getFSpyImageRatio()),this.camera.updateProjectionMatrix()},n.prototype.runCallback=function(){"function"===e(this.callback)&&this.callback(this)},n}();export default n;
