!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("three")):"function"==typeof define&&define.amd?define(["three"],a):(t=t||self).FSpyCamera=a(t.THREE)}(this,(function(t){"use strict";var a=function(){function t(){this.xhr=new XMLHttpRequest}return t.prototype.open=function(t,a){this.xhr.open("GET",t),this.xhr.responseType="json",this.xhr.addEventListener("load",(function(){var t,i="ie"===(-1!==(t=window.navigator.userAgent.toLowerCase()).indexOf("msie")||-1!==t.indexOf("trident")?"ie":-1!==t.indexOf("edge")?"edge":-1!==t.indexOf("chrome")?"chrome":-1!==t.indexOf("safari")?"safari":-1!==t.indexOf("firefox")?"firefox":-1!==t.indexOf("opera")?"opera":"other")?JSON.parse(this.response):this.response;a(i)})),this.xhr.send()},t}();function i(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}return function(){function e(a,e){void 0===e&&(e={}),this.inputData="",this.fspyImageRatio=0,this.fSpyCameraData=null,this.rotationMatrix=new t.Matrix4,this.targetCanvas=a,this.targetCanvasRect=this.targetCanvas.getBoundingClientRect(),this.winWidth=window.innerWidth,this.winHeight=window.innerHeight,this.winRatio=this.winWidth/this.winHeight,this.camera=new t.PerspectiveCamera,this.canvasWidth=this.targetCanvasRect.width,this.canvasHeight=this.targetCanvasRect.height,this.cameraTransforms=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.options=e,this.callback=function(){},this.jsonType=i(this.inputData),this.initCameraAspect=0,this.cameraFov=0}return e.prototype.load=function(t,a){if(this.inputData=t,this.callback=a,"string"===this.jsonType&&"string"==typeof this.inputData){var i=(s=this.inputData,-1===(n=s.lastIndexOf("."))?"":s.slice(n+1));"json"===i.toLowerCase()?this.loadJson(this.inputData):"fspy"===i.toLowerCase()&&e.loadBinary()}else"object"==typeof this.inputData?this.onLoadJson(this.inputData):console.error("Please put fSpy's json path or parsed json in the first argument");var s,n},e.prototype.loadJson=function(t){(new a).open(t,this.onLoadJson.bind(this))},e.loadBinary=function(){console.log("temp")},e.prototype.onLoadJson=function(t){this.fSpyCameraData=t,null!=this.fSpyCameraData&&(this.cameraTransforms=this.fSpyCameraData.cameraTransform.rows),this.fspyImageRatio=this.getFSpyImageRatio(),this.setMatrix(),this.createCamera(),window.addEventListener("resize",this.onResize.bind(this)),this.runCallback.bind(this)()},e.onLoadBinary=function(){console.log("temp")},e.prototype.setMatrix=function(){var t=this.cameraTransforms.reduce((function(t,a){return t.push.apply(t,a),t}),[]);return this.rotationMatrix.elements=t,this.rotationMatrix},e.getWinRatio=function(){return window.innerWidth/window.innerHeight},e.prototype.getFSpyImageRatio=function(){return null!=this.fSpyCameraData?this.fSpyCameraData.imageWidth/this.fSpyCameraData.imageHeight:0},e.getVFovDegFromRad=function(a){return t.MathUtils.radToDeg(a)},e.prototype.createCamera=function(){if(null!=this.cameraTransforms&&null!=this.fSpyCameraData){var t=this.cameraTransforms;this.cameraFov=e.getVFovDegFromRad(this.fSpyCameraData.verticalFieldOfView),this.camera.fov=this.cameraFov,this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.near=.01,this.camera.far=1e4,this.camera.position.set(t[0][3],t[1][3],t[2][3]),this.camera.setRotationFromMatrix(this.rotationMatrix),this.initCameraAspect=this.getFSpyImageRatio(),this.onResize()}},e.prototype.onResize=function(){this.targetCanvasRect=this.targetCanvas.getBoundingClientRect(),this.canvasWidth=this.targetCanvasRect.width,this.canvasHeight=this.targetCanvas.height;var t=this.initCameraAspect;this.canvasWidth/this.canvasHeight<=t?(this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.zoom=1):(this.camera.aspect=this.canvasWidth/this.canvasHeight,this.camera.zoom=this.canvasWidth/this.canvasHeight/t),this.camera.updateProjectionMatrix()},e.prototype.runCallback=function(){"function"===i(this.callback)&&this.callback()},e}()}));
