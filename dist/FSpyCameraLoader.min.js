!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("three")):"function"==typeof define&&define.amd?define(["three"],a):(t=t||self).FSpyCamera=a(t.three)}(this,(function(t){"use strict";var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var e in a)a.hasOwnProperty(e)&&(t[e]=a[e])})(t,e)};var e=function(){function a(){this.data=null,this.internalImageRatio=0,this.internalCameraFov=0,this.radian=0,this.internalRotationMatrix=new t.Matrix4,this.internalCameraPosition=new t.Vector3(0),this.internalIsSetData=!1}return a.prototype.setData=function(t){this.internalIsSetData=!0,this.data=t,this.onSetData()},a.prototype.removeData=function(){this.internalIsSetData=!1,this.data=null,this.onRemoveData()},a.prototype.getData=function(){return this.data},a.prototype.onSetData=function(){this.internalImageRatio=this.calcImageRatio(),null!=this.data&&(this.internalCameraFov=this.getVFovDegFromRad(this.data.verticalFieldOfView),this.setMatrix(),this.setCameraPosition())},a.prototype.onRemoveData=function(){this.internalImageRatio=0,this.internalCameraFov=0,this.internalRotationMatrix=new t.Matrix4,this.internalCameraPosition=new t.Vector3(0)},a.prototype.calcImageRatio=function(){return null!=this.data?this.data.imageWidth/this.data.imageHeight:0},a.prototype.getVFovDegFromRad=function(a){return this.radian=t.MathUtils.radToDeg(a),this.radian},a.prototype.setMatrix=function(){if(null!=this.data){var a=this.data.cameraTransform.rows.reduce((function(t,a){return t.push.apply(t,a),t}),[]);return this.internalRotationMatrix.elements=a,this.internalRotationMatrix}return new t.Matrix4},a.prototype.setCameraPosition=function(){if(null!=this.data){var a=this.data.cameraTransform.rows;this.internalCameraPosition=new t.Vector3(a[0][3],a[1][3],a[2][3])}},Object.defineProperty(a.prototype,"imageRatio",{get:function(){return this.internalImageRatio},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationMatrix",{get:function(){return this.internalRotationMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraFov",{get:function(){return this.internalCameraFov},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraPosition",{get:function(){return this.internalCameraPosition},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isSetData",{get:function(){return this.internalIsSetData},enumerable:!0,configurable:!0}),a}();return function(i){function n(a){var n=i.call(this)||this;return t.Loader.call(n,a),n.targetCanvas=null,n.targetCanvasRect=null,n.targetCanvasSize=new t.Vector2,n.camera=new t.PerspectiveCamera,n.dataManager=new e,n}return function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(n,i),n.prototype.load=function(a,e,i,n){var r=this,o=new t.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("json"),o.load(a,(function(t){e(r.parse(t))}),i,n)},n.prototype.parse=function(t){"object"==typeof t&&(this.dataManager.setData(t),this.createCamera())},n.prototype.setCanvas=function(t){this.targetCanvas=t},n.prototype.removeCanvas=function(){this.targetCanvas=null},n.prototype.setResizeUpdate=function(t){t&&this.setCanvas(t),window.addEventListener("resize",this.onResize.bind(this))},n.prototype.removeResizeupdate=function(t){t&&this.removeCanvas(),window.removeEventListener("resize",this.onResize.bind(this))},n.prototype.createCamera=function(){this.dataManager.isSetData&&(this.camera.fov=this.dataManager.cameraFov,null!=this.targetCanvasSize?this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y:this.camera.aspect=0,this.camera.position.set(this.dataManager.cameraPosition.x,this.dataManager.cameraPosition.y,this.dataManager.cameraPosition.z),this.camera.setRotationFromMatrix(this.dataManager.rotationMatrix),this.onResize())},n.prototype.onResize=function(){if(null!=this.targetCanvas){this.targetCanvasRect=this.targetCanvas.getBoundingClientRect(),this.targetCanvasSize=new t.Vector2(this.targetCanvasRect.width,this.targetCanvasRect.height);var a=this.dataManager.imageRatio;this.targetCanvasSize.x/this.targetCanvasSize.y<=a?(this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y,this.camera.zoom=1):(this.camera.aspect=this.targetCanvasSize.x/this.targetCanvasSize.y,this.camera.zoom=this.targetCanvasSize.x/this.targetCanvasSize.y/a),this.camera.updateProjectionMatrix()}},n}(t.Loader)}));
